const chartPanel=document.querySelector("#chartPanel");let chartId=0,responseData={},choiceData={},qnaireData={};function createPieChart(e,t){let a=document.createElement("div");a.className="pieChart",a.id="chartdiv"+ ++chartId,e.appendChild(a);let n=am5.Root.new(a.id);n.setThemes([am5themes_Animated.new(n)]);var l=n.container.children.push(am5percent.PieChart.new(n,{endAngle:270})).series.push(am5percent.PieSeries.new(n,{valueField:"value",categoryField:"category",endAngle:270}));l.states.create("hidden",{endAngle:-90}),l.data.setAll(t),l.appear(1e3,100)}function createColumnChart(e){let t=document.createElement("div");t.className="chartContainer",chartPanel.appendChild(t);let a=document.createElement("div");a.className="chartTitle",a.innerHTML="题目正确率",t.appendChild(a);let n=document.createElement("div");n.className="columnChart",n.id="chartdiv"+ ++chartId,t.appendChild(n);var l=am5.Root.new(n.id);l.setThemes([am5themes_Animated.new(l)]);var i=l.container.children.push(am5xy.XYChart.new(l,{panX:!0,panY:!0,wheelX:"panX",wheelY:"zoomX",pinchZoomX:!0}));i.set("cursor",am5xy.XYCursor.new(l,{})).lineY.set("visible",!1);var r=am5xy.AxisRendererX.new(l,{minGridDistance:30});r.labels.template.setAll({rotation:-90,centerY:am5.p50,centerX:am5.p100,paddingRight:15});var c=i.xAxes.push(am5xy.CategoryAxis.new(l,{maxDeviation:.3,categoryField:"question",renderer:r,tooltip:am5.Tooltip.new(l,{})})),s=i.yAxes.push(am5xy.ValueAxis.new(l,{maxDeviation:.3,renderer:am5xy.AxisRendererY.new(l,{})})),o=i.series.push(am5xy.ColumnSeries.new(l,{name:"题目正确率",xAxis:c,yAxis:s,valueYField:"accuracy",sequencedInterpolation:!0,categoryXField:"question",tooltip:am5.Tooltip.new(l,{labelText:"正确率：{valueY}"})}));o.columns.template.setAll({cornerRadiusTL:5,cornerRadiusTR:5}),o.columns.template.adapters.add("fill",function(e,t){return i.get("colors").getIndex(o.columns.indexOf(t))}),o.columns.template.adapters.add("stroke",function(e,t){return i.get("colors").getIndex(o.columns.indexOf(t))}),c.data.setAll(e),o.data.setAll(e),o.appear(1e3),i.appear(1e3,100)}function createNameList(e,t,a){let n=document.createElement("div");if(n.className="nameListContainer","choice"===t){let l=document.createElement("div");l.className="answerContainer",l.innerHTML="正确答案："+a.correctAnswer,n.appendChild(l)}let i=document.createElement("div");i.className="listContainer",n.appendChild(i);let r=document.createElement("ul");r.className="listHeaders",i.appendChild(r);let c=document.createElement("ul");if(c.className="listBodies",i.appendChild(c),"choice"===t)["A","B","C","D"].forEach(e=>{let t=document.createElement("li");t.className="listTitle",t.innerHTML="选择"+e+"选项名单",r.appendChild(t);let n=document.createElement("li");n.className="listContent",n.style.display="none",c.appendChild(n),a[e].forEach(e=>{n.innerHTML+=e+" "}),t.onclick=()=>{let e=r.children,a=c.children;for(let n=0;n<e.length;n++)e[n]==t?(e[n].className="currentTitle",a[n].style.display="block"):(e[n].className="listTitle",a[n].style.display="none")}}),r.children[0].className="currentTitle",c.children[0].style.display="block";else if("qnaire"===t){let s=Object.values(a);i.appendChild(c),s.forEach(e=>{let t=document.createElement("li");t.className="listTitle",t.innerHTML='选择"'+e.optionName+'"选项名单';let a=document.createElement("li");a.className="listContent",a.style.display="none",e.people.forEach(e=>{a.innerHTML+=e+" "}),r.appendChild(t),c.appendChild(a),t.onclick=()=>{let e=r.children,a=c.children;for(let n=0;n<e.length;n++)e[n]==t?(e[n].className="currentTitle",a[n].style.display="block"):(e[n].className="listTitle",a[n].style.display="none")}}),r.children[0].className="currentTitle",c.children[0].style.display="block"}e.appendChild(n)}function processAccuracy(e){let t=Object.values(e),a=[],n={};t.forEach(e=>{n={question:e.questionName,accuracy:e.accuracy},a.push(n)}),createColumnChart(a),t.forEach(e=>{processChoiceData(e)})}function processChoiceData(e){let t=[],a={},n={},l="",i=0;["A","B","C","D"].forEach(a=>{n={category:l=a,value:i=e[a].length},t.push(n)});let r=document.createElement("div");r.className="chartContainer",chartPanel.appendChild(r);let c=document.createElement("div");c.className="chartTitle",c.innerHTML=e.questionName,r.appendChild(c),createPieChart(r,t),delete e.questionName,delete e.accuracy,createNameList(r,"choice",a=e)}function processQnaireData(e){let t=[],a={},n={};for(let l=0;l<e.optionNumber;l++){let i=e["option_"+(l+1)];n={category:i.optionName,value:i.peopleNumber},t.push(n)}let r=document.createElement("div");r.className="chartContainer",chartPanel.appendChild(r);let c=document.createElement("div");c.className="chartTitle",c.innerHTML=e.questionName,r.appendChild(c),createPieChart(r,t),delete e.questionName,delete e.optionNumber,createNameList(r,"qnaire",a=e)}function sendRequest(){var e=new XMLHttpRequest;let t="/statistics?collectionId="+getCollectionId();e.open("GET",t,!1),e.onreadystatechange=function(){4==e.readyState&&(200==e.status||304==e.status)&&(responseData=JSON.parse(e.responseText))&&(choiceData=responseData.data_choice,qnaireData=responseData.data_qnaire,choiceData&&processAccuracy(choiceData),qnaireData)&&Object.values(qnaireData).forEach(e=>{processQnaireData(e)})},e.send()}function getCollectionId(){var e=document.location.toString().split("//"),t=e[1].lastIndexOf("/"),a=e[1].substring(t+1);return -1!=a.indexOf("?")&&(a=a.split("?")[0]),a}function encryption(e){return window.btoa(encodeURIComponent(e))}function decryption(e){return decodeURIComponent(window.atob(e))}