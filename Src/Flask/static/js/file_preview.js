const questionList=document.querySelector("#question_list"),collectionTitle=document.querySelector("#collectionTitle"),collector=document.querySelector("#collector"),deadline=document.querySelector("#deadline"),description=document.querySelector("#description"),myalert=document.querySelector(".alert"),myblur=document.querySelector("#blur"),myform=document.querySelector("#myform");let qnum=0,question_id=0,countdown=2;function createNameOrSnoOrFile(e,t,n,l){let i=document.createElement("li"),a=document.createElement("h1"),r=document.createElement("div");r.innerHTML=t,r.className="readOnlyInput";let o=document.createElement("div");o.className="detail",o.innerHTML=textareaToDiv(n);let d=document.createElement("div");d.className="inputContent",d.innerHTML=l,questionList.appendChild(i),i.appendChild(a),a.appendChild(r),o.innerHTML&&i.appendChild(o),i.appendChild(d),i.id=question_id.toString()}function createSingleOrMultiple(e,t,n,l,i){let a=document.createElement("li");a.id=question_id.toString();let r=document.createElement("h1"),o=document.createElement("div");o.innerHTML=t,o.className="readOnlyInput";let d=document.createElement("div");d.className="detail",d.innerHTML=textareaToDiv(n);let s=document.createElement("div");s.className="single"===e?"singleQuestionBox":"multiQuestionBox",s="single"===e?addChoice_for_filePreview(0,l,i):addChoice_for_filePreview(1,l,i);let c=document.createElement("div");c.className="correctAnswerBox",c.innerHTML="正确答案：";for(let m=0;m<i.length;m++)c.innerHTML+=" "+i[m]+" ";questionList.appendChild(a),a.appendChild(r),r.appendChild(o),d.innerHTML&&a.appendChild(d),a.appendChild(s),a.appendChild(c)}function addChoice_for_filePreview(e,t,n){let l=document.createElement("div"),i=["A","B","C","D"],a=0===e?"correctSingle":"correctMulti",r=0===e?"wrongSingle":"wrongMulti";for(let o=0;o<4;o++){let d=document.createElement("input");d.type=0===e?"radio":"checkbox",d.value=i[o],d.disabled=!0,d.className=0===e?"singleOption":"multiOption";let s=document.createElement("span");s.className="optionContent",s.appendChild(document.createTextNode(i[o])),l.appendChild(d),l.appendChild(s),-1!=t.indexOf(i[o].charCodeAt()-65)&&(-1!=n.indexOf(i[o])?d.classList.toggle(a):d.classList.toggle(r))}for(let c=0;c<t.length;c++)l.children[2*t[c]].checked="true";for(let m=0;m<t.length;m++)t[m]=String.fromCharCode(t[m]+65);return l}function createQuestionnaire(e,t,n,l,i){let a=document.createElement("li"),r=document.createElement("h1"),o=document.createElement("div");o.innerHTML=e,o.className="readOnlyInput",o.id=question_id;let d=document.createElement("div");d.className="detail",d.innerHTML=textareaToDiv(t);let s=document.createElement("div");s.className="qnQuestionBox";let c=0;for(let m=0;m<n.length;m++){c=0;for(let u=0;u<l.length;u++)if(l[u]-1===m){c=1;break}c?s.appendChild(addQuestion_for_filePreview(i,n[m],!0)):s.appendChild(addQuestion_for_filePreview(i,n[m],!1))}questionList.appendChild(a),a.appendChild(r),r.appendChild(o),d.innerHTML&&a.appendChild(d),a.appendChild(s)}function addQuestion_for_filePreview(e,t,n){let l=document.createElement("div");l.className="qnOption";let i=document.createElement("input");i.className="qnOptionChoice",i.type="single"===e?"radio":"checkbox",i.disabled="disabled",i.checked=n;let a=document.createElement("div");return a.className="qnOptionContent",a.innerHTML=textareaToDiv(t),l.appendChild(i),l.appendChild(a),l}let tmp_json=document.getElementById("collection").innerHTML;tmp_json=eval("("+tmp_json+")"),console.log(tmp_json);let formData=JSON.parse(JSON.stringify(tmp_json)),formDataArr=[],formDataObj={},formDataLen=0;const reg=/(\d+)$/;let lastNum=1;function processFormData(){for(item in formData){let e=reg.exec(item);if(e){let t=e[1];t!=lastNum&&(formDataArr.push(formDataObj),formDataObj={});let n=item,l=formData[item];formDataObj[n]=l,lastNum=t}}formDataArr.push(formDataObj),formDataLen=formDataArr.length}function createQuestion(){collectionTitle.innerHTML=Object.values(formData)[0],collector.innerHTML=Object.values(formData)[1],deadline.innerHTML=Object.values(formData)[2],description.innerHTML=Object.values(formData)[3];for(let e=0;e<formDataLen;e++){formDataArr[e];let t=Object.keys(formDataArr[e]),n=Object.values(formDataArr[e]);if(question_id++,-1!=t[0].indexOf("question_name"))createNameOrSnoOrFile("name",n[0],n[1],n[2]);else if(-1!=t[0].indexOf("question_sno"))createNameOrSnoOrFile("sno",n[0],n[1],n[2]);else if(-1!=t[0].indexOf("question_file"))createNameOrSnoOrFile("file",n[0],n[1],n[2]);else if(-1!=t[0].indexOf("question_radio")){let l=n[n.length-1].toString().charCodeAt()-"A".charCodeAt(),i=n[n.length-2].toString();createSingleOrMultiple("single",n[0],n[1],[l],[i])}else if(-1!=t[0].indexOf("question_multipleChoice")){let a=[],r=[];for(let o=0;o<t.length;o++)-1!=t[o].indexOf("submit_mulans")?a.push(n[o].toString().charCodeAt()-"A".charCodeAt()):-1!=t[o].indexOf("checked_mulans")&&r.push(n[o].toString());createSingleOrMultiple("multiple",n[0],n[1],a,r)}else{let d=[],s=[];for(let c=0;c<t.length;c++)-1!=t[c].indexOf("qn_option")?d.push(n[c]):-1!=t[c].indexOf("submit_qnaire")&&s.push(n[c]);let m=s.length>1?"multiple":"single";createQuestionnaire(n[0],n[1],d,s,m)}}}function addLoadEvent(e){var t=window.onload;"function"!=typeof window.onload?window.onload=e:window.onload=function(){t(),e()}}function timeOutClose(){countdown>0?setTimeout("timeOutClose();",1e3):(myalert.style.display="none",myblur.style.display="none"),countdown--}function textareaToDiv(e){return e=(e=(e=e.replace(/\r\n/g,"<br/>")).replace(/\n/g,"<br/>")).replace(/\s/g," ")}addLoadEvent(processFormData),console.log(formDataArr),addLoadEvent(createQuestion);