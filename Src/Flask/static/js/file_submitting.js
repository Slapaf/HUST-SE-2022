const questionList=document.querySelector("#question_list"),collectionTitle=document.querySelector("#collectionTitle"),collector=document.querySelector("#collector"),deadline=document.querySelector("#deadline"),description=document.querySelector("#description"),myalert=document.querySelector(".alert"),myblur=document.querySelector("#blur"),myform=document.querySelector("#myform");let qnum=0,question_id=0,countdown=2;function creatNameOrSnoOrFile(e,t,n){let l=document.createElement("li"),i=document.createElement("h1"),a=document.createElement("input");a.type="text",a.value=t,a.className="readOnlyInput",a.readOnly="true";let r=document.createElement("div");r.className="detail",r.innerHTML=textareaToDiv(n);let o=document.createElement("input");o.type="file"==e?"file":"text",o.className="inputContent",o.required=!0,o.maxLength=25,questionList.appendChild(l),l.appendChild(i),i.appendChild(a),r.innerHTML&&l.appendChild(r),l.appendChild(o),l.id=question_id.toString(),a.name="question_"+e+question_id,o.name="submit_"+e+question_id}function creatSingleOrMultiple(e,t,n){let l=document.createElement("li");l.id=question_id.toString();let i=document.createElement("h1"),a=document.createElement("input");a.type="text",a.value=t,a.className="readOnlyInput",a.readOnly="true",a.name="question_"+("single"===e?"radio":"multipleChoice")+question_id;let r=document.createElement("div");r.className="detail",r.innerHTML=textareaToDiv(n);let o=document.createElement("div");o.className="single"===e?"singleQuestionBox":"multiQuestionBox";let d=["A","B","C","D"];for(let s=0;s<4;s++){let c=document.createElement("div");c.className="single"===e?"singleOption":"multiOption";let u=document.createElement("input");u.type="single"===e?"radio":"checkbox",u.name="submit_checked_"+("single"===e?"radio":"mulans")+question_id,u.value=d[s],u.required="single"===e;let m=document.createElement("label");m.innerHTML=d[s],c.appendChild(u),c.appendChild(m),o.appendChild(c)}questionList.appendChild(l),l.appendChild(i),i.appendChild(a),r.innerHTML&&(console.log(r.innerHTML),l.appendChild(r)),l.appendChild(o)}function creatQuestionnaire(e,t,n,l,i){let a=document.createElement("li"),r=document.createElement("h1"),o=document.createElement("input");o.type="text",o.value=e,o.className="readOnlyInput",o.readOnly="true",o.id=question_id,o.name="question_qnaire"+question_id;let d=document.createElement("div");d.className="detail",d.innerHTML=textareaToDiv(t);let s=document.createElement("div");s.className="qnQuestionBox";for(let c=0;c<n;c++){let u=document.createElement("div");u.className="qnOption";let m=document.createElement("input");m.className="qnOptionChoice",m.type="single"===i?"radio":"checkbox",m.name="submit_checked_qnaire"+question_id,m.value=(c+1).toString(),m.required="single"===i;let p=document.createElement("div");p.className="qnOptionContent",p.innerHTML=textareaToDiv(l[c]),u.appendChild(m),u.appendChild(p),s.appendChild(u)}questionList.appendChild(a),a.appendChild(r),r.appendChild(o),d.innerHTML&&a.appendChild(d),a.appendChild(s)}let tmp_json=document.getElementById("collection").innerHTML;tmp_json=eval("("+tmp_json+")");let formData=JSON.parse(JSON.stringify(tmp_json)),formDataArr=[],formDataObj={},formDataLen=0;const reg=/(\d+)$/;let lastNum=1;function processFormData(){for(item in formData){let e=reg.exec(item);if(e){let t=e[1];t!=lastNum&&(formDataArr.push(formDataObj),formDataObj={});let n=item,l=formData[item];formDataObj[n]=l,lastNum=t}}formDataArr.push(formDataObj),formDataLen=formDataArr.length}function creatQuestion(){collectionTitle.innerHTML=Object.values(formData)[0],collector.innerHTML=Object.values(formData)[1],deadline.innerHTML=Object.values(formData)[2],description.innerHTML=Object.values(formData)[3];for(let e=0;e<formDataLen;e++){formDataArr[e];let t=Object.keys(formDataArr[e]),n=Object.values(formDataArr[e]);if(question_id++,-1!=t[0].indexOf("question_name"))creatNameOrSnoOrFile("name",n[0],n[1]);else if(-1!=t[0].indexOf("question_sno"))creatNameOrSnoOrFile("sno",n[0],n[1]);else if(-1!=t[0].indexOf("question_file"))creatNameOrSnoOrFile("file",n[0],n[1]);else if(-1!=t[0].indexOf("question_radio"))creatSingleOrMultiple("single",n[0],n[1]);else if(-1!=t[0].indexOf("question_multipleChoice"))creatSingleOrMultiple("multiple",n[0],n[1]);else{let l=0,i=[];for(let a=0;a<t.length;a++)-1!=t[a].indexOf("qn_option")&&(l++,i.push(n[a]));creatQuestionnaire(n[0],n[1],l,i,n[n.length-1])}}}function addLoadEvent(e){var t=window.onload;"function"!=typeof window.onload?window.onload=e:window.onload=function(){t(),e()}}function check(){let e=0,t=document.querySelectorAll(".multiQuestionBox");for(let n=0;n<t.length;n++){let l=t[n].querySelectorAll("input[type='checkbox']"),i=0;for(let a=0;a<l.length;a++)l[a].checked&&i++;i<2&&(e=1)}let r=document.querySelectorAll(".qnQuestionBox");for(let o=0;o<r.length;o++){console.log(r[o]);let d=r[o].querySelectorAll("input[type='checkbox']"),s=0;for(let c=0;c<d.length;c++)d[c].checked&&s++;s<2&&d.length>0&&(e=2)}if(e){let u=myalert.getElementsByTagName("h1")[0];return 1===e?u.innerHTML="多选题请至少选择两个选项":2===e&&(u.innerHTML="多选题请至少选择两个选项!"),myalert.style.display="block",myblur.style.display="block",countdown=2,timeOutClose(),!1}return!0}function timeOutClose(){countdown>0?setTimeout("timeOutClose();",1e3):(myalert.style.display="none",myblur.style.display="none"),countdown--}function checkDeadline(){let e=new Date().getTime(),t=(new Date(Object.values(formData)[2]).getTime()-e)/1e3;return parseInt(t/86400),parseInt(t/3600),parseInt(t%3600/60),parseInt(t%60),!(t<=0)||(document.getElementById("refuse-submit").style.display="flex",!1)}function textareaToDiv(e){return e=(e=(e=e.replace(/\r\n/g,"<br/>")).replace(/\n/g,"<br/>")).replace(/\s/g," ")}myform.onsubmit=()=>checkDeadline()&&check(),addLoadEvent(checkDeadline),addLoadEvent(processFormData),addLoadEvent(creatQuestion),addLoadEvent(()=>{description.innerHTML=textareaToDiv(description.innerHTML)});